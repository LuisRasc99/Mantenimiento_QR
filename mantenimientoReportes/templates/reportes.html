{% extends 'base.html' %}

{% block content %}
<main class="container py-5">
  <section class="card card-body text-center">
    {% csrf_token %} 
    {% if user.is_authenticated %}
      <h1>Reportes de {{ user.username }}</h1>
    {% endif %}
  </section>
  <p></p>
  <div class="text-start mb-3">
    <a href="{% url 'nuevo_reporte' %}" class="btn btn-primary">Añadir nuevo reporte</a>
  </div>
  <p></p>
  <section class="card card-body">
    <table>
      <thead>
        <tr> 
          <th>Foto</th>
          <th>Nombre de la máquina</th>
          <th>Descripción</th>
          <th>Número de parte</th>
          <th>Piezas</th>
          <th>Costo</th>
          <th>Horas</th>
          <th>Fecha de reemplazo</th>
          <th>Fecha de reporte</th>
          <th>Código QR</th> 
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for reporte in reportes %}
        <tr>
          {% if reporte.foto %}
            <td><img src="{{ reporte.foto.url }}" alt="Foto del reporte" width="100" height="100"></td>
          {% else %}
            <td>No hay foto</td>
          {% endif %}
          <td>{{ reporte.nombre_maquina|default:"" }}</td>
          <td>{{ reporte.descripcion|default:"" }}</td>
          <td>{{ reporte.numero_parte|default:"" }}</td>
          <td>{{ reporte.piezas|default:"" }}</td>
          <td>{{ reporte.costo|default:"" }}</td>
          <td>{{ reporte.horas|default:"" }}</td>
          <td>{{ reporte.fecha_reemplazo|default:"" }}</td>
          <td>{{ reporte.fecha_reporte|default:"" }}</td>
          {% if reporte.qr %}
          <td><img src="{{ reporte.qr.url }}" alt="Código QR" width="100" height="100"></td>
          {% else %}
            <td>No hay Codigo QR</td>
          {% endif %}
          <td>
            <form id="eliminarreporteForm_{{ reporte.id_reporte }}" method="POST" action="{% url 'eliminar_reporte' id_reporte=reporte.id_reporte %}">
              {% csrf_token %}
              <button type="button" class="btn btn-danger" onclick="mostrarConfirmacion('{{ reporte.id_reporte }}')">
                <i class="fa-solid fa-trash" style="color: #ffffff;"></i>
              </button>
            </form>
            <a href="{% url 'modificar_reporte' id_reporte=reporte.id_reporte %}" class="btn btn-modificar" >
              <i class="fa-solid fa-pen" style="color: #ffffff;"></i>
            </a>
            <a href="{% url 'imprimir_qr' id_reporte=reporte.id_reporte formato='png' %}" class="btn btn-info">
              <i class="fa-solid fa-download" style="color: #ffffff;"></i>
            </a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </section>
</main>

<script>
  // Función para mostrar el cuadro de diálogo de confirmación antes de enviar el formulario
  function mostrarConfirmacion(id_reporte) {
    if (confirm("¿Estás seguro de que deseas eliminar este reporte?")) {
      // Si el usuario hace clic en "Aceptar", enviar el formulario de eliminación
      const form = document.getElementById(`eliminarreporteForm_${id_reporte}`);
      form.submit();
    }
  }
</script>
      
{% endblock %}
